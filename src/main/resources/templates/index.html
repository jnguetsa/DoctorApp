<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org" data-theme='' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.thymeleaf.org ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listes des patients</title>
    <script src="../static/app.js"></script>
    <link rel="stylesheet" th:href="@{/css/output.css}">
</head>
<body class="bg-base-200 min-h-screen">

<div class="container mx-auto p-6">

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-primary">Liste des patients</h1>

        <button class="p-2 rounded-full text-white cursor-pointer bg-green-900 hover:bg-green-800 transition-colors"
                onclick="document.getElementById('modal-add-patient').showModal()">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <path d="M8 12h8"/>
                <path d="M12 8v8"/>
            </svg>
        </button>
    </div>

    <!-- Message si liste vide -->
    <div th:if="${#lists.isEmpty(listepatient)}"
         class="flex flex-col items-center justify-center min-h-[50vh] text-center">
        <span class="text-6xl mb-4">ðŸ˜ž</span>
        <p class="text-xl font-medium text-base-content/80">Aucun patient trouvÃ©.</p>
        <p class="text-sm mt-2 text-base-content/60">Ajoutez votre premier patient avec le bouton + ci-dessus !</p>
    </div>

    <!-- Liste des patients -->
    <div th:unless="${#lists.isEmpty(listepatient)}" class="card bg-base-100 shadow-xl">
        <div class="card-body p-4">
            <!-- Barre de recherche -->
            <div>
                <form th:action="@{/index}" method="get" class="flex flex-row justify-items-start gap-2">
                    <button class="btn btn-success font-bold text-green-100">Recherche</button>
                    <label class="input">
                        <svg class="h-5 opacity-50" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <g stroke-linejoin="round" stroke-linecap="round" stroke-width="2.5" fill="none"
                               stroke="currentColor">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.3-4.3"></path>
                            </g>
                        </svg>
                        <input name="keyword" type="search" th:value="${keyword}"
                               placeholder="Rechercher un patient..."/>
                    </label>
                </form>
            </div>

            <div class="overflow-x-auto h-96 mt-4">
                <!--                <table class="table table-zebra table-pin-rows table-pin-cols">-->
                <table class="table table-zebra table-spin-cols">

                    <thead>
                    <tr>
                        <th>Nom</th>
                        <th>PrÃ©nom</th>
                        <th>Date de naissance</th>
                        <th>Score</th>
                        <th>Statut</th>
                        <th class="text-center">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="patient : ${listepatient}">
                        <td th:text="${patient.nom}"></td>
                        <td th:text="${patient.prenom}"></td>
                        <td th:text="${patient.dateNaissance}"></td>
                        <td th:text="${patient.score}"></td>
                        <td>
                            <div th:classappend="${patient.malade ? 'badge badge-error px-3 text-green-100 font-bold' : 'badge badge-success px-6 text-green-100 font-bold'}">
                                <span th:text="${patient.malade ? 'Malade' : 'Sain'}"></span>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="flex items-center justify-center gap-3">
                                <!-- Bouton Modifier (Ã  implÃ©menter plus tard si besoin) -->
                                <button onclick="document.getElementById('modifierPatient').showModal()"
                                        class="rounded-lg p-2 cursor-pointer hover:bg-base-200">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                         fill="none"
                                         stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <path d="M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"/>
                                        <path d="m15 5 4 4"/>
                                    </svg>
                                </button>

                                <!-- Bouton Supprimer -->
                                <button th:onclick="'document.getElementById(\'deleteModal-' + ${patient.id} + '\').showModal()'"
                                        class="p-2 rounded-full cursor-pointer text-white bg-red-900 hover:bg-red-800">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                         fill="none"
                                         stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                         stroke-linejoin="round">
                                        <path d="M3 6h18"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
                                        <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                        <path d="M10 11v6"/>
                                        <path d="M14 11v6"/>
                                    </svg>
                                </button>
                            </div>

                            <!-- Modal de confirmation suppression -->
                            <dialog th:id="'deleteModal-' + ${patient.id}" class="modal">
                                <div class="modal-box text-left">
                                    <form method="dialog">
                                        <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                                 viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                 stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M18 6 6 18"/>
                                                <path d="m6 6 12 12"/>
                                            </svg>
                                        </button>
                                    </form>
                                    <h3 class="font-bold text-lg text-error">Confirmer la suppression</h3>
                                    <p class="py-4">
                                        Voulez-vous vraiment supprimer le patient
                                        <span class="font-bold" th:text="${patient.nom + ' ' + patient.prenom}"></span>
                                        ?
                                    </p>
                                    <div class="modal-action flex gap-3 mt-6">
                                        <form method="dialog">
                                            <button class="btn">Annuler</button>
                                        </form>
                                        <a th:href="@{/admin/deletePatient(id=${patient.id})}"
                                           class="btn btn-error text-white">Supprimer</a>
                                    </div>
                                </div>
                                <form method="dialog" class="modal-backdrop">
                                    <button>Fermer</button>
                                </form>
                            </dialog>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination / Nombre de lignes par page -->
            <div class="flex items-center gap-2 p-2">
                <span class="text-sm font-bold bg-green-600 p-1 px-4 text-white rounded-xl">
                    Lignes par page
                </span>
                <div class="flex items-center gap-2">

                    <select class="select select-bordered select-sm w-20 cursor-pointer"
                            onchange="window.location.href='/index?size=' + this.value">
                        <option th:selected="${size == 5}" value="5">5</option>
                        <option th:selected="${size == 10}" value="10">10</option>
                        <option th:selected="${size == 20}" value="20">20</option>
                        <option th:selected="${size == 60}" value="60">60</option>
                        <option th:selected="${size == 100}" value="100">100</option>
                        <option th:selected="${size == 150}" value="150">150</option>
                        <option th:selected="${size == 200}" value="200">200</option>

                    </select>
                </div>

            </div>
        </div>
    </div>

    <!-- MODAL AJOUT PATIENT (corrigÃ©) -->
    <dialog id="modal-add-patient" class="modal modal-middle">
        <div class="modal-box max-w-2xl">
            <form method="dialog">
                <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
            </form>

            <h3 class="font-bold text-lg mb-4">Nouveau patient</h3>

            <form th:action="@{/admin/addPatient}" th:object="${patient}" method="post" class="space-y-4">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="label" for="nom"><span class="label-text">Nom</span></label>
                        <input th:field="*{nom}" type="text" id="nom" class="input input-bordered w-full" required/>
                        <span class="text-error text-xs" th:if="${#fields.hasErrors('nom')}" th:errors="*{nom}"></span>
                    </div>

                    <div>
                        <label class="label" for="prenom"><span class="label-text">PrÃ©nom</span></label>
                        <input type="text" class="input input-bordered w-full" id="prenom" th:field="*{prenom}"
                               required/>
                        <span class="text-error text-xs" th:if="${#fields.hasErrors('prenom')}"
                              th:errors="*{prenom}"></span>
                    </div>

                    <div>
                        <label class="label" for="dateNaissance"><span
                                class="label-text">Date de naissance</span></label>
                        <input type="date" id="dateNaissance" class="input input-bordered w-full"
                               th:field="*{dateNaissance}" required/>
                        <span class="text-error text-xs" th:if="${#fields.hasErrors('dateNaissance')}"
                              th:errors="*{dateNaissance}"></span>
                    </div>

                    <div>
                        <label class="label " for="score"><span class="label-text">Score</span></label>
                        <input type="number" min="0" id="score" max="100" class="input input-bordered w-full"
                               th:field="*{score}"/>
                    </div>

                    <div class="flex flex-col gap-1">
                        <fieldset class="fieldset bg-base-100 border-base-300 rounded-box border p-4">
                            <legend class="fieldset-legend">Statut du Patient</legend>
                            <label class="label cursor-pointer justify-start gap-3">
                                <input type="checkbox" class="toggle toggle-primary" th:field="*{malade}"/>
                                <span class="label-text">Est malade ?</span>
                            </label>
                        </fieldset>
                        <span class="text-error text-xs" th:if="${#fields.hasErrors('malade')}"
                              th:errors="*{malade}"></span>
                    </div>
                </div>

                <div class="modal-action mt-6">
                    <button type="button" class="btn" onclick="document.getElementById('modal-add-patient').close()">
                        Annuler
                    </button>
                    <button type="submit" class="btn btn-primary">Enregistrer</button>
                </div>
            </form>
        </div>
    </dialog>

</div>

</body>


</html>